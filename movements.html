<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Castelo | Movimientos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- En <head> -->
    <script>
        window.APP_VER = "20250907b";  /* cambialo cuando subas nueva versión */
    </script>
    <script src="./js/app-loader.js?v=1" defer></script>
    <!-- CDNs con defer (opcional pero recomendado) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
</head>
<body>
  <!-- Top nav -->
  <header class="border-bottom bg-body px-3 py-2 d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-2">
      <span class="fw-bold">Castelo</span>
      <a class="btn btn-link p-0" href="index.html">Inicio</a>
      <a class="btn btn-link p-0" href="config.html">Configuración</a>
      <a class="btn btn-link p-0" href="labels.html">Etiquetas</a>
      <a class="btn btn-link p-0" href="movements.html">Movimientos</a>
    </div>
    <div class="form-check form-switch m-0">
      <input class="form-check-input" type="checkbox" id="themeSwitch" />
      <label class="form-check-label" for="themeSwitch">Dark</label>
    </div>
  </header>

  <main class="container py-3">
    <h1 class="h4 mb-3">Movimientos</h1>

    <div class="d-flex flex-wrap gap-2 align-items-end mb-3">
    <div>
        <label class="form-label mb-1">Entidad</label>
        <select id="mv_entity" class="form-select form-select-sm" style="min-width:160px">
        <option value="">Todas</option>
        <option value="labels">labels</option>
        <option value="emptycans">emptycans</option>
        <!-- a futuro podés sumar más entidades -->
        </select>
    </div>

    <div>
        <label class="form-label mb-1">Ítem</label>
        <select id="mv_item" class="form-select form-select-sm" style="min-width:220px">
        <option value="">Todos los ítems</option>
        </select>
    </div>

    <div>
        <label class="form-label mb-1">Desde</label>
        <input id="mv_from" type="date" class="form-control form-control-sm">
    </div>
    <div>
        <label class="form-label mb-1">Hasta</label>
        <input id="mv_to" type="date" class="form-control form-control-sm">
    </div>

    <div class="d-flex flex-wrap gap-2 align-items-end mb-3">
    <!-- Entidad / Ítem / Fechas -->
    ...
    <!-- Agregá estos dos: -->
    <input id="movementsSearch" class="form-control form-control-sm" placeholder="Buscar…" style="min-width:180px">
    <select id="movementsPageSize" class="form-select form-select-sm" style="width:auto">
        <option value="10" selected>10</option>
        <option value="25">25</option>
        <option value="50">50</option>
    </select>
    <!-- Botones -->
    <div class="ms-auto d-flex gap-2">
        <button id="mv_clear"  class="btn btn-outline-secondary btn-sm">Limpiar</button>
        <button id="mv_export" class="btn btn-outline-secondary btn-sm">CSV Listado</button>
        <button id="mv_daily_csv" class="btn btn-outline-secondary btn-sm">CSV Diario</button>
        <button id="mv_export_all" class="btn btn-primary btn-sm">Exportar TODO (ZIP)</button>
    </div>
    </div>

    </div>
    <!-- Totales -->
    <div id="mv_totals" class="row g-2 my-3">
    <div class="col-12 col-md-4">
        <div class="card"><div class="card-body">
        <div class="small text-muted">Altas</div>
        <div id="mv_total_in" class="h4 m-0">0</div>
        </div></div>
    </div>
    <div class="col-12 col-md-4">
        <div class="card"><div class="card-body">
        <div class="small text-muted">Bajas</div>
        <div id="mv_total_out" class="h4 m-0">0</div>
        </div></div>
    </div>
    <div class="col-12 col-md-4">
        <div class="card"><div class="card-body">
        <div class="small text-muted">Neto</div>
        <div id="mv_total_net" class="h4 m-0">0</div>
        </div></div>
    </div>
    </div>

    <!-- Desglose -->
    <div id="mv_breakdown_wrap" class="card d-none">
    <div class="card-body">
        <h6 id="mv_breakdown_title" class="card-title mb-2">Desglose</h6>
        <div class="table-responsive">
        <table class="table table-sm table-striped mb-0" id="mv_breakdown_table">
            <thead><tr><th>Grupo</th><th>Altas</th><th>Bajas</th><th>Neto</th></tr></thead>
            <tbody></tbody>
        </table>
        </div>
    </div>
    </div>

    <!-- Totales por día + saldo acumulado -->
    <div id="mv_daily_wrap" class="card mt-3 d-none">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
        <h6 class="card-title mb-2">Totales por día (con saldo acumulado)</h6>
        <button id="mv_daily_csv" class="btn btn-sm btn-outline-secondary">CSV diario</button>
        </div>
        <div class="table-responsive">
        <table class="table table-sm table-striped mb-0" id="mv_daily_table">
            <thead>
            <tr>
                <th>Fecha</th><th>Altas</th><th>Bajas</th><th>Neto</th><th>Saldo acum.</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
        </div>
    </div>
    </div>

    <table id="movementsTable" class="table table-striped mt-3">
      <thead>
        <tr>
          <th>ID</th>
          <th>Fecha</th>
          <th>Entidad</th>
          <th>Tipo</th>
          <th>Cant.</th>
          <th>Descripción</th>
          <th>Última mod.</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <nav aria-label="Movements pagination">
      <ul id="movementsPager" class="pagination pagination-sm"></ul>
    </nav>
  </main>

  <!-- Modal reutilizable por si en el futuro querés ver detalle -->
  <div class="modal fade" id="entityModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <div class="modal-header"><h5 id="entityModalTitle" class="modal-title">Detalle</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button></div>
      <div id="entityModalBody" class="modal-body"></div>
      <div class="modal-footer"><button id="entityModalSave" class="btn btn-primary d-none">Guardar</button></div>
    </div></div>
  </div>

</body>
</html>
