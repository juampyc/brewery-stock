<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Producci√≥n | Brewery Stock</title>

  <!-- CDN supabase-js v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Tu config con window.SUPABASE_CONFIG = { url, anonKey } -->
  <script src="js/config.supabase.js"></script>

  <!-- Cliente + capa de datos + shim GAS -->
  <script src="js/supabase_client.js"></script>
  <script src="js/supabase_data.js"></script>
  <script src="js/gas_shim.js"></script>
  
  <!-- Estilos -->
  <link rel="stylesheet" href="css/styles.css?v=3" />
  <link rel="stylesheet" href="css/pills.css" />

  <!-- Lib SweetAlert -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Config Global -->
  <script src="js/config.js"></script>

  <!-- P√°gina -->
  <script src="js/production.js" defer></script>
</head>
<body>
  <div id="site-header"></div>
  <script src="js/header.js" defer></script>

  <main class="container" style="margin-top:16px;">
    <!-- Acciones -->
    <section class="card" style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
      <h2 style="margin:0;">üè≠ Producci√≥n</h2>
      <div class="actions">
        <button id="newProdBtn" class="btn">‚ûï Nueva producci√≥n (Enlatar)</button>
      </div>
    </section>

    <!-- Listado de producciones -->
    <section class="card" style="margin-top:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
        <label class="field" style="min-width:160px;">
          <span>Por p√°gina</span>
          <select id="pageSize">
            <option>10</option>
            <option selected>20</option>
            <option>50</option>
          </select>
        </label>
        <div class="actions"><button id="refreshBtn" class="btn">‚Üª Refrescar</button></div>
      </div>

      <div style="overflow:auto;margin-top:12px;">
        <table class="table" id="prodTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Marca</th>
              <th>Estilo</th>
              <th>Cantidad</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody><tr><td colspan="6" style="text-align:center;padding:18px;">Cargando...</td></tr></tbody>
        </table>
      </div>

      <div id="pager" style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:12px;">
        <button id="prevPage" class="btn ghost">‚¨Ö Anterior</button>
        <div id="pageInfo" class="muted small">P√°gina 1 de 1 (0 registros)</div>
        <button id="nextPage" class="btn ghost">Siguiente ‚û°</button>
      </div>
    </section>
  </main>

  <!-- Backdrop -->
  <div id="backdrop" class="backdrop" aria-hidden="true"></div>

  <!-- Modal: Nueva producci√≥n (Enlatar) -->
  <div id="newProdModal" class="modal" aria-hidden="true">
    <div class="modal__content labels-compact">
      <header class="modal__header">
        <h3>Nueva producci√≥n (Enlatar)</h3>
        <button id="closeNewProd" class="icon-btn" aria-label="Cerrar">‚úï</button>
      </header>
      <form id="newProdForm" class="form">
        <div class="grid form grid-2">
          <label class="field">
            <span>Cantidad (latas)</span>
            <input type="number" min="1" step="1" name="qty" required placeholder="Ej: 500" />
          </label>
          <label class="field span-2">
            <span>Estilo de producci√≥n</span>
            <select id="prodStyleCombo" name="styleCombo" required></select>
            <div id="prodStylePreview" class="help"></div>
          </label>
        </div>
        <footer class="modal__footer">
          <button type="button" class="btn" id="cancelNewProd">Cancelar</button>
          <button type="submit" class="btn primary" id="submitNewProd">Crear</button>
        </footer>
      </form>
    </div>
  </div>

  <!-- Etiquetar producci√≥n -->
  <div id="labelProdModal" class="modal" aria-hidden="true">
    <div class="modal__content labels-compact">
      <header class="modal__header">
        <h3 style="display:flex;align-items:center;gap:.5rem;">
          üè∑Ô∏è Etiquetar producci√≥n
          <small id="labelProdPreview" class="muted" style="font-weight:400;"></small>
        </h3>
        <button id="closeLabelProd" class="icon-btn" type="button" aria-label="Cerrar">‚úï</button>
      </header>

      <form id="labelProdForm" class="form">
        <input type="hidden" name="prodId">

        <!-- Modo -->
        <div class="field">
          <label>Tipo de etiquetado</label>
          <div class="segmented" style="margin-top:.5rem;">
            <label><input type="radio" name="labelMode" value="same" checked><span>Marca / Estilo</span></label>
            <label><input type="radio" name="labelMode" value="custom"><span>Personalizada</span></label>
          </div>
        </div>

        <div class="grid grid-2" style="margin-top:.75rem;gap:12px;">
          <!-- Card Marca/Estilo -->
          <div class="card soft" id="brandStyleBox">
            <div class="grid grid-2" style="gap:.75rem;">
              <label class="field">
                <span>Marca</span>
                <select id="labelBrandSelect"></select>
              </label>

              <label class="field">
                <span>Estilo</span>
                <select id="labelStyleSelect"></select>
              </label>
            </div>
            <div class="small muted" id="labelHint" style="margin-top:.25rem;">
              Eleg√≠ marca y estilo para usar las etiquetas correspondientes.
            </div>
          </div>

          <!-- Card Personalizada -->
          <div class="card soft" id="customLabelBox" style="display:none;">
            <label class="field">
              <span>Etiqueta personalizada</span>
              <select id="customLabelSelect">
                <option value="">Cargando...</option>
              </select>
            </label>
            <div class="small muted" style="margin-top:.25rem;">
              Se consumir√° stock de la <strong>etiqueta por nombre</strong>.
            </div>
          </div>
        </div>

        <footer class="modal__footer">
          <div class="muted small">‚Üµ Enter guarda ‚Ä¢ Esc cancela</div>
          <div style="display:flex;gap:.5rem;">
            <button id="cancelLabelProd" class="btn" type="button">Cancelar</button>
            <button id="submitLabelProd" class="btn primary" type="submit">Guardar</button>
          </div>
        </footer>
      </form>
    </div>
  </div>

</body>
</html>
